function Background(){const e=this;this.show=!0,this.img=new Image,this.x=0,this.y=0,this.width=0,this.height=0,this.size=1,this.loadImage=function(t){e.img.src=t,e.img.onload=function(){e.width=e.img.width,e.height=e.img.height}},this.toggle=function(){e.show=!e.show},this.display=function(){this.img.src&&this.show&&lns.canvas.ctx.drawImage(this.img,this.x,this.y,this.size*this.width,this.height*this.size)}}function Canvas(e,t,n,s,a){const i=this;this.canvas=document.getElementById(e),this.dpr=a&&window.devicePixelRatio||1,this.scale=1,this.ctx=this.canvas.getContext("2d"),this.ctx.miterLimit=1,this.lineWidth=1,this.setBGColor=function(e){i.bgColor=e,i.canvas.style.backgroundColor=e},this.setBGColor(s),this.setLineWidth=function(e){i.ctx.lineWidth=i.lineWidth=+e,i.ctx.miterLimit=1},this.setScale=function(e){i.scale=+e,i.setWidth(i.width),i.setHeight(i.height)},this.setWidth=function(e){i.width=+e,i.canvas.width=+e*i.dpr*i.scale,i.reset()},this.setHeight=function(e){i.height=+e,i.canvas.height=+e*i.dpr*i.scale,i.reset()},this.reset=function(){i.ctx.scale(1,1),i.ctx.scale(this.dpr*i.scale,i.dpr*i.scale),i.canvas.style.zoom=1/i.dpr,i.ctx.lineWidth=i.lineWidth,i.ctx.miterLimit=1},this.setWidth(t),this.setHeight(n),this.fitCanvasToDrawing=function(){lns.draw.reset();let e=0,t={x:1e4,y:1e4},n={x:0,y:0};for(let s=0;s<lns.anim.layers.length;s++){const a=lns.anim.layers[s],i=lns.anim.drawings[a.d];for(let s=0;s<i.length;s++){const l=i[s];"end"!=l&&(e=Math.max(e,4*a.r),t.x=Math.min(t.x,l.x+a.x),t.y=Math.min(t.y,l.y+a.y),n.x=Math.max(n.x,l.x+a.x),n.y=Math.max(n.y,l.y+a.y))}}lns.ui.faces.width.update(n.x-t.x+2*e),lns.ui.faces.height.update(n.y-t.y+2*e);for(let n=0;n<lns.anim.layers.length-1;n++)lns.anim.layers[n].x-=t.x-e>0?t.x-e:0,lns.anim.layers[n].y-=t.y-e>0?t.y-e:0}}function Data(e){const t=this;this.copyFrame=[],this.pasteFrames=[],this.saveStates={current:{drawings:void 0,layers:void 0},prev:{drawings:void 0,layers:void 0}},this.saveState=function(){t.saveStates.current.drawings?(t.saveStates.prev.drawings=_.cloneDeep(t.saveStates.current.drawings),t.saveStates.prev.layers=_.cloneDeep(t.saveStates.current.layers)):(t.saveStates.prev.drawings=_.cloneDeep(e.drawings),t.saveStates.prev.layers=_.cloneDeep(e.layers)),t.saveStates.current.drawings=_.cloneDeep(e.drawings),t.saveStates.current.layers=_.cloneDeep(e.layers)},this.undo=function(){t.saveStates.prev.drawings?(e.drawings=_.cloneDeep(t.saveStates.prev.drawings),e.layers=_.cloneDeep(t.saveStates.prev.layers),t.saveStates.current.drawings=_.cloneDeep(t.saveStates.prev.drawings),t.saveStates.current.layers=_.cloneDeep(t.saveStates.prev.layers),t.saveStates.prev.drawings=void 0,t.saveStates.prev.layers=void 0):console.log("%c Can't undo ","color:lightblue;background:gray;"),lns.ui.drawings.clear(),lns.ui.layers.clear(),lns.ui.update()},this.copy=function(){lns.draw.reset(),t.copyFrame=[];for(let n=0;n<e.layers.length-1;n++)e.layers[n].isInFrame(e.currentFrame)&&t.copyFrame.push(e.layers[n])},this.paste=function(){t.saveState(),0==t.pasteFrames.length&&t.pasteFrames.push(e.currentFrame);for(let e=0;e<t.pasteFrames.length;e++)for(let n=0;n<t.copyFrame.length;n++)t.copyFrame[n].addIndex(t.pasteFrames[e]);t.clearSelected(),lns.draw.reset(),lns.ui.update()},this.selectFrame=function(e){e.classList.contains("selected")?(t.pasteFrames.splice(t.pasteFrames.indexOf(+e.textContent),1),e.classList.remove("selected")):(e.classList.add("selected"),t.pasteFrames.push(+e.textContent))},this.selectAll=function(){const e=Array.from(lns.ui.frames.children).filter(e=>e.classList.contains("selected")).length<lns.ui.frames.children.length-1;lns.ui.frames.looper(n=>{e&&n.classList.remove("selected"),t.selectFrame(n)})},this.selectRange=function(){const e=prompt("Start frame:"),n=prompt("end frame:");lns.ui.frames.looper(e=>{t.selectFrame(e)},e,n)},this.clearSelected=function(){t.pasteFrames=[];const e=document.getElementsByClassName("selected");for(let t=e.length-1;t>=0;t--)e[t].classList.remove("selected")},this.clearLines=function(){lns.draw.drawing=[]},this.clearLayers=function(){t.saveState();for(let t=e.layers.length-2;t>=0;t--)if(e.layers[t].isInFrame(e.currentFrame)){e.layers[t].removeIndex(e.currentFrame)||lns.ui.layers.remove(t)}},this.cutTopLayer=function(){for(let t=e.layers.length-2;t>=0;t--){if(e.layers[t].isInFrame(e.currentFrame)){e.layers[t].removeIndex(e.currentFrame)||lns.ui.layers.remove(t)}break}},this.cutBottomLayer=function(){for(let t=0;t<e.layers.length;t++){if(e.layers[t].isInFrame(e.currentFrame)){e.layers[t].removeIndex(e.currentFrame)||lns.ui.layers.remove(t)}break}},this.clearFrame=function(){t.clearLines(),t.clearLayers()},this.deleteFrame=function(n){const s=void 0!==n?n:lns.anim.currentFrame;t.saveState();for(let t=e.layers.length-2;t>=0;t--)layer=e.layers[t].shiftIndex(s,-1),layer||lns.ui.layers.remove(t);lns.ui.update()},this.deleteFrameRange=function(){t.saveState();const e=+prompt("Start frame:"),n=+prompt("End frame:");if(n>0){for(let s=n;s>=e;s--)t.deleteFrame(s);lns.draw.cutEnd(),lns.ui.setFrame(0)}},this.cutLastSegment=function(){lns.ui.layers.cutLayerSegment(),lns.draw.pop()},this.cutLastLine=function(){lns.ui.layers.cutLayerLine(),lns.draw.popOff()},this.insert=function(n){lns.draw.reset(),t.saveState();for(let t=0,s=e.layers.length-1;t<s;t++)e.layers[t].shiftIndex(e.currentFrame+n.dir,1),lns.anim.addLayer(e.layers[t].removeIndex(e.currentFrame+n.dir)),e.frame=e.currentFrame+n.dir;lns.ui.update()},this.addMultipleCopies=function(){t.copyFrame=[],t.clearSelected();let e=+prompt("Number of copies: ");if(t.copy(),e)for(let n=0;n<e;n++)lns.ui.play.next(1),t.paste();lns.ui.update()},this.offsetDrawing=function(n){lns.draw.reset();const s=[],a=lns.anim.layers.some(e=>e.toggled);for(let t=0;t<e.layers.length-1;t++){const n=e.layers[t];(n.isInFrame(e.currentFrame)&&!a||a&&n.toggled)&&s.push(e.layers[t])}if(s){if(t.saveState(),n||(n=new Cool.Vector(+prompt("x"),+prompt("y"))),n){let e=[];if(lns.ui.layers.length>0)for(let t=0;t<lns.ui.layers.length;t++)lns.ui.layers[t].toggled&&e.push(lns.ui.layers[t]);else e=s;for(let t=0;t<e.length;t++)e[t].x+=n.x,e[t].y+=n.y}}else console.log("%c No layers in frame ","color:yellow; background:black;")},this.explode=function(t){lns.draw.reset();const n=+prompt("Number of frames?");for(let s=0;s<e.layers.length-1;s++){const a=e.layers[s];if(a.isInFrame(e.currentFrame))switch(a.endFrame=a.startFrame+n,e.currentState.end<a.endFrame&&(e.currentState.end=a.endFrame),t.type){case"Explode":a.addTween({prop:"e",sf:a.f.s,ef:a.f.e,sv:0,ev:e.drawings[a.d].length});break;case"Reverse":a.addTween({prop:"s",sf:a.f.s,ef:a.f.e,sv:0,ev:e.drawings[a.d].length});break;case"ExRev":const t=Math.floor(n/2);a.addTween({prop:"e",sf:a.f.s,ef:a.f.s+t,sv:0,ev:e.drawings[a.d].length}),a.addTween({prop:"s",sf:a.f.s+t,ef:a.f.e,sv:0,ev:e.drawings[a.d].length})}}lns.ui.update()}}function Draw(e){const t=this;if(Object.defineProperty(this,"layer",{get:function(){return lns.anim.layers[lns.anim.layers.length-1]}}),Object.defineProperty(this,"drawing",{get:function(){return lns.anim.drawings[lns.anim.drawings.length-1]},set:function(e){lns.anim.drawings[lns.anim.drawings.length-1]=e}}),lns.anim.drawings.push([]),lns.anim.layers.push(new Layer({...e,d:Math.max(lns.anim.drawings.length-1,0),f:{s:lns.anim.currentFrame,e:lns.anim.currentFrame}})),this.setProperties=function(e){for(const n in e)void 0!==t.layer[n]&&lns.ui&&lns.ui.faces[n].update(e[n])},this.setProperty=function(e,n){lns.anim.updateProperty(n.prop,e),t.layer[n.prop]=e},this.setDefaults=function(){t.setProperties(e)},this.reset=function(e){t.drawing.length>0&&(lns.anim.drawings.push([]),lns.anim.layers.push(new Layer({n:+lns.ui.faces.n.value,r:+lns.ui.faces.r.value,w:+lns.ui.faces.w.value,v:+lns.ui.faces.v.value,c:lns.ui.faces.c.value,d:lns.anim.drawings.length-1,f:{s:+e||lns.anim.currentFrame,e:+e||lns.anim.currentFrame}})),lns.data.saveState()),lns.ui.update()},this.cutEnd=function(){let e=0;for(let t=0;t<lns.anim.layers.length-1;t++){const n=lns.anim.layers[t];n.endFrame>e&&(e=n.endFrame)}lns.draw.layer.endFrame>e&&(lns.draw.layer.endFrame=e)},this.hasDrawing=function(){return lns.anim.layers.some(e=>e.isInFrame(lns.anim.currentFrame)&&lns.anim.drawings[e.d].length>0)},this.brush=0,this.brushSpread=1,this.startDots=!1,this.dots=10,this.grass=0,this.mouseTimer=performance.now(),this.mouseInterval=30,this.isDrawing=!1,this.outSideCanvas=function(e){e.toElement!=lns.canvas.canvas&&(t.isDrawing&&t.reset(),t.isDrawing=!1)},this.pop=function(){t.drawing.length>0&&("end"==t.drawing.pop()&&t.drawing.pop(),t.drawing.push("end"))},this.popOff=function(){if(t.drawing.length>0){t.drawing.pop();for(let e=t.drawing.length-1;e>0&&"end"!=t.drawing[e];e--)t.drawing.pop()}},this.update=function(e){performance.now()>t.mouseInterval+t.mouseTimer&&(t.mouseTimer=performance.now(),t.isDrawing&&(t.brush<=0?t.addLine(Math.round(e.offsetX),Math.round(e.offsetY)):t.addBrush(Math.round(e.offsetX),Math.round(e.offsetY))))},this.addBrush=function(e,n){const s=t.brush*t.brush*t.brushSpread;let a=1;t.grass>0&&(a*=t.grass);let i=new Cool.Vector(e,n);for(let l=0;l<t.brush;l++){let l=new Cool.Vector(e+Cool.randomInt(-s,s),n+Cool.randomInt(-s,s));for(;l.dist(i)>s;)l=new Cool.Vector(e+Cool.randomInt(-s,s),n+Cool.randomInt(-s,s));l.divide(lns.canvas.scale),l.x>0&&l.x<lns.canvas.width&&l.y>0&&l.y<lns.canvas.height&&t.drawing.push(l);const r=Cool.randomInt(1,3);for(let e=0;e<r;e++)l.x>0&&l.x<lns.canvas.width&&l.y>0&&l.y<lns.canvas.height&&t.drawing.push(new Cool.Vector(l.x+Cool.randomInt(-1,1),l.y+Cool.randomInt(a)));t.drawing.push("end")}},this.addLine=function(e,n){t.drawing.push(new Cool.Vector(e,n).divide(lns.canvas.scale))},this.start=function(e){1!=e.which||lns.render.isPlaying||e.altKey?e.altKey&&(t.startDots=new Cool.Vector(Math.round(e.offsetX),Math.round(e.offsetY))):(t.isDrawing=!0,t.mouseTimer=performance.now(),t.brush<=0?t.addLine(Math.round(e.offsetX),Math.round(e.offsetY)):t.addBrush(Math.round(e.offsetX),Math.round(e.offsetY)))},this.end=function(e){if(t.startDots){const n=Math.abs(t.startDots.x-e.offsetX),s=Math.abs(t.startDots.y-e.offsetY),a=n/s,i=n/(a*t.dots/2),l=s/(1/a*t.dots/2);let[r,o]=t.startDots.x<e.offsetX?[t.startDots.x,e.offsetX]:[e.offsetX,t.startDots.x],[c,d]=t.startDots.y<e.offsetY?[t.startDots.y,e.offsetY]:[e.offsetY,t.startDots.y];for(let e=r;e<o;e+=i)for(let n=c;n<d;n+=l){const s=Math.round(e)+Cool.randomInt(-i/2,i/2),a=Math.round(n)+Cool.randomInt(-l/2,l/2),r=Cool.randomInt(1,3);for(let e=0;e<r;e++)t.drawing.push(new Cool.Vector(s+Cool.randomInt(-1,1),a+Cool.randomInt(-1,1)));t.drawing.push("end")}t.startDots=!1}else 1==e.which&&(t.isDrawing=!1,"end"!=t.drawing[t.drawing.length-2]&&t.drawing.length>1?t.drawing.push("end"):t.drawing.pop())},window.PointerEvent)lns.canvas.canvas.addEventListener("pointermove",t.update),lns.canvas.canvas.addEventListener("pointerdown",t.start),lns.canvas.canvas.addEventListener("pointerup",t.end);else{lns.canvas.canvas.addEventListener("mousemove",t.update),lns.canvas.canvas.addEventListener("mousedown",t.start),lns.canvas.canvas.addEventListener("mouseup",t.end);const e={which:1};function n(t,n){if(t.preventDefault(),t.touches[0]){const s=t.target.getBoundingClientRect();e.offsetX=t.targetTouches[0].pageX-s.left-window.scrollX,e.offsetY=t.targetTouches[0].pageY-s.top-window.scrollY,e.which=1,n(e)}}lns.canvas.canvas.addEventListener("touchstart",e=>{n(e,t.start)}),lns.canvas.canvas.addEventListener("touchmove",e=>{n(e,t.update)}),lns.canvas.canvas.addEventListener("touchend",n=>{t.end(e)})}document.addEventListener("mousemove",t.outSideCanvas)}function Files(e){const t=this;this.saveFilesEnabled=!1,this.saveSettingsOnUnload=e.save||!1,this.fileName=void 0,this.saveFile=function(n,s){lns.draw.reset(),lns.ui.play.checkEnd(),lns.anim.drawings.pop(),lns.anim.layers.pop(),t.fileName=lns.ui.faces.title.value||prompt("Name this file:"),e.fit&&confirm("Fit canvas?")&&lns.canvas.fitCanvasToDrawing();const a={v:"2.4"};a.w=+lns.canvas.width,a.h=+lns.canvas.height,a.fps=+lns.anim.fps,e.bg&&(a.bg=lns.canvas.bgColor);let i=lns.anim.layers.map(e=>e.c);i=[...new Set(i)],a.mc=i.length>1;let l=[];if(n.single){for(let e=0;e<lns.anim.layers.length;e++)if(lns.anim.layers[e].isInFrame(lns.anim.currentFrame)){const t=_.cloneDeep(lns.anim.layers[e]);t.startFrame=0,t.endFrame=0,l.push(t)}}else l=lns.anim.layers;for(let e=0;e<l.length;e++)l[e].clean();a.l=l;const r=[];for(let e=0;e<l.length;e++){const t=l[e].d;r.includes(t)||r.push(t)}a.d=[];for(let e=0;e<r.length;e++){const t=r[e],n=lns.anim.drawings[t],s=[];for(let e=0;e<n.length;e++){const t=n[e];"end"==t?s.push(0):s.push([t.x,t.y])}a.d[t]=s}Object.keys(lns.anim.states).length>1&&(a.s=_.cloneDeep(lns.anim.states),delete a.s.default);const o=JSON.stringify(a);if(t.fileName){const e=new Blob([o],{type:"application/x-download;charset=utf-8"});saveAs(e,t.fileName+".json"),s&&s(t.fileName),lns.ui.faces.title.value=t.fileName}},this.loadFile=function(e,n){t.fileName=e,t.fileName&&(".json"!=t.fileName.slice(t.fileName.length-5)&&(t.fileName+=".json"),fetch(t.fileName).then(e=>e.json()).then(e=>{t.loadJSON(e,n)}).catch(e=>{alert("File not found: "+e.message),console.error(e)}))},this.loadJSON=function(t,n){lns.anim.drawings=[],lns.anim.layers=[],lns.anim.loadData(t,(function(){for(let e=0;e<t.l.length;e++)lns.anim.layers[e]=new Layer(t.l[e]);lns.canvas.setWidth(t.w),lns.canvas.setHeight(t.h),lns.ui.faces.fps.update(t.fps),t.bg&&lns.canvas.setBGColor(t.bg),lns.draw.reset(),n&&n(t,e)}))},this.reOpenFile=function(){t.saveFile({},(function(e){location.href+=`?src=/${prompt("Enter location:")}/${e}.json`}))},this.openFile=function(){const e=document.createElement("input");e.type="file",e.click(),e.onchange=function(){t.readFile(e.files,lns.ui.updateFIO)}},this.readFile=function(e,n){for(let s,a=0;s=e[a];a++){if(!s.type.match("application/json"))continue;const e=new FileReader;e.onload=function(e){t.fileName=s.name.split(".")[0],t.loadJSON(JSON.parse(e.target.result),n)},e.readAsText(s)}},window.File&&window.FileReader&&window.FileList&&window.Blob&&(t.saveFilesEnabled=!0,console.log("%c Save file enabled ","color:lightgreen;background:black;"),lns.canvas.canvas.addEventListener("dragover",(function(e){e.preventDefault()})),lns.canvas.canvas.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),t.readFile(e.dataTransfer.files,lns.ui.updateFIO)}))),window.addEventListener("beforeunload",(function(n){t.saveSettingsOnUnload&&lns.ui.settings.saveSettings(),e.reload&&(n.returnValue="Did you save dumbhole?")}))}function Render(e,t){const n=this;this.lps=e||12,this.interval=1e3/this.lps,this.timer=performance.now(),this.onionSkinNum=0,this.onionSkinIsVisible=!1,this.setOnionSkin=function(e){n.onionSkinNum=+e,n.onionSkinIsVisible=+e>0},this.reset=function(){lns.anim.frame=0,lns.anim.isPlaying=!1,lns.canvas.ctx.miterLimit=1,lns.ui.update()},this.toggle=function(){lns.anim.isPlaying||(lns.ui.play.checkEnd(),lns.ui.timeline.update()),lns.anim.isPlaying=!lns.anim.isPlaying},this.setLps=function(e){n.lps=+e,n.interval=1e3/n.lps,lns.anim.lps=n.lps},this.update=function(e){if(performance.now()>n.interval+n.timer||"cap"==e){if(n.timer=performance.now(),lns.anim.isPlaying&&lns.ui.timeline.update(),lns.canvas.ctx.clearRect(0,0,lns.canvas.width,lns.canvas.height),lns.ui.capture.bg&&(lns.ui.capture.frames>0||lns.ui.capture.isVideo)&&(lns.canvas.ctx.fillStyle=lns.canvas.bgColor,lns.canvas.ctx.fillRect(0,0,lns.canvas.width,lns.canvas.height)),lns.bgImage.display(),n.onionSkinNum>0&&n.onionSkinIsVisible){const e=lns.anim.currentFrame;for(let t=1;t<=n.onionSkinNum;t++){const s=e-t;if(s>=0){const e=`rgba(105,150,255,${1.5-t/n.onionSkinNum})`;lns.anim.currentFrame=s,lns.anim.overrideProperty("c",e),lns.anim.draw()}}lns.anim.cancelOverride(),lns.anim.currentFrame=e}lns.anim.draw(),lns.anim.update()}lns.ui.capture.isCapturing||window.requestAnimFrame(n.update)},this.start=function(){window.requestAnimFrame(n.update)}}class LnsAnim extends LinesAnimation{updateProperty(e,t){for(let n=0;n<this.layers.length-1;n++)this.layers[n].toggled&&(this.layers[n][e]=t)}addLayer(e){-1==this.layers.indexOf(e)&&this.layers.splice(lns.anim.layers.length-1,0,e)}}class Layer{constructor(e){this.d=e.d,this.x=e.x||0,this.y=e.y||0,this.f=e.f,this.t=e.t||[],this.n=e.n,this.r=e.r,this.w=e.w,this.v=e.v,this.c=e.c,this.ws=e.ws||!1,this.toggled=!1,this.resetTweens()}clean(){delete this.toggled,delete this.pc}toggle(){this.toggled?"#00CC96"==this.c&&(this.c=this.pc):(this.pc=this.c,this.c="#00CC96"),this.toggled=!this.toggled}remove(){lns.anim.layers.splice(lns.anim.layers.indexOf(this),1)}addTween(e){this.t.push(e),e.sf<this.startFrame&&(this.startFrame=e.sf),e.ef>this.endFrame&&(this.endFrame=e.ef)}get startFrame(){return this.f.s}set startFrame(e){this.f.s=Math.max(0,+e),this.resetTweens()}get endFrame(){return this.f.e}set endFrame(e){this.f.e=Math.max(0,+e),this.resetTweens()}addIndex(e){if(!this.isInFrame(e))if(this.f.s-1==e)this.f.s-=1;else{if(this.f.e+1!=e)return new Layer({...this,f:{s:e,e:e}});this.f.e+=1}return this}removeIndex(e){if(this.startFrame!=e||this.endFrame!=e){if(this.startFrame==e)this.startFrame+=1;else if(this.endFrame==e)this.endFrame-=1;else if(e>this.startFrame&&e<this.endFrame){const t=_.cloneDeep(this);return t.startFrame=e+1,t.endFrame=this.endFrame,t.resetTweens(),this.endFrame=e-1,this.resetTweens(),t}return this.resetTweens(),this}}shiftIndex(e,t){return console.log(e,t),t||(t=-1),this.startFrame>=e&&(this.startFrame+=t),this.endFrame>=e&&(this.endFrame+=t),this.resetTweens(),this}isInFrame(e){return-1!=lns.anim.layers.indexOf(this)&&(e>=this.f.s&&e<=this.f.e)}get props(){return{n:this.n,r:this.r,w:this.w,v:this.v}}resetTweens(){for(let e=0;e<this.t.length;e++){const t=this.t[e];t.sf<this.startFrame&&(t.sf=this.startFrame),t.ef>this.endFrame&&(t.ef=this.endFrame)}}}class UILayer extends UICollection{constructor(e,t){super(e),this.addClass("layer"),this.layer=t,this.toggle=new UIToggle({type:"layer-toggle",text:""+t.d,callback:e.callback}),this.edit=new UIButton({type:"layer-edit",text:"✎",callback:()=>{const e=new UIModal("Edit Layer",lns,this.position,()=>{this.update(),lns.ui.update()});e.add(new UIButton({text:"Cut Segment",callback:()=>{const e=lns.anim.drawings[t.d];e.pop(),e.pop(),e.push("end")}})),e.add(new UIButton({text:"Cut Line",callback:()=>{const e=lns.anim.drawings[t.d];e.pop();for(let t=e.length-1;t>0&&"end"!=e[t];t--)e.pop()}})),e.add(new UIButton({text:"Clone",callback:()=>{const e=new Layer(_.cloneDeep(t));e.startFrame=e.endFrame=t.endFrame+1,lns.anim.layers.splice(lns.anim.layers.length-1,0,e),lns.ui.play.setFrame(t.endFrame+1)}})),e.add(new UIButton({text:"Split",callback:()=>{const e=new Layer(_.cloneDeep(t));e.startFrame=lns.anim.currentFrame+1,t.endFrame=lns.anim.currentFrame,lns.anim.layers.splice(lns.anim.layers.length-1,0,e),lns.ui.play.setFrame(t.endFrame+1)}})),e.add(new UIElement({class:"break"})),e.add(new UILabel({text:"Start Frame:"})),e.add(new UIBlur({value:t.startFrame,callback:function(e){t.startFrame=+e}})),e.add(new UIElement({class:"break"})),e.add(new UILabel({text:"End Frame:"})),e.add(new UIBlur({value:t.endFrame,callback:function(e){t.endFrame=+e}}))}}),this.tween=new UIButton({text:"⧉",type:"layer-tween",callback:()=>{const e={prop:"e",sf:lns.anim.currentFrame,ef:lns.anim.currentFrame+10,sv:0,ev:"end"},n=new UIModal("Add Tween",lns,this.position,(function(){e.ev=lns.anim.drawings[t.d].length,t.addTween(e),lns.ui.update()}));n.add(new UILabel({text:"Property:"})),n.add(new UISelect({options:["e","s","n","r","w","v","x","y"],value:"e",selected:"e",callback:function(t){e.prop=t}})),n.add(new UILabel({text:"Start Frame:"})),n.add(new UIBlur({value:e.sf,callback:function(t){e.sf=+t}})),n.add(new UILabel({text:"End Frame:"})),n.add(new UIBlur({value:e.ef,callback:function(t){e.ef=+t}})),n.add(new UILabel({text:"Start Value:"})),n.add(new UIBlur({value:e.sv,callback:function(t){e.sv=+t}})),n.add(new UILabel({text:"End Value:"})),n.add(new UIBlur({value:e.ev,callback:function(t){e.ev=+t}}))}}),this.remove=new UIButton({type:"remove",text:"🗑",callback:()=>{lns.anim.layers.splice(lns.anim.layers.indexOf(this),1),lns.ui.update()}}),this.left=new UIDragButton({text:"⬗",type:"left",callback:(e,n)=>{t.startFrame+=(e||-1)*(n||1),this.update(),lns.ui.update()}}),this.right=new UIDragButton({text:"⬖",type:"right",callback:(e,n)=>{console.log(e,n),t.endFrame+=(e||1)*(n||1),this.update(),lns.ui.update()}}),this.append(this.toggle),this.append(this.edit),this.append(this.tween),this.append(this.remove),this.append(this.left),this.append(this.right)}get html(){return this.el}}class UITween extends UICollection{constructor(e,t,n){super(e),this.addClass("tween"),this.tween=t,this.edit=new UIButton({text:"✎",type:"tween-edit",callback:()=>{const e=new UIModal("Edit Tween",lns,this.position,(function(){lns.ui.update()}));e.add(new UILabel({text:"Start Frame:"})),e.add(new UIBlur({value:t.sf,callback:function(e){t.sf=+e}})),e.add(new UILabel({text:"End Frame:"})),e.add(new UIBlur({value:t.ef,callback:function(e){console.log(t),t.ef=+e}})),e.add(new UILabel({text:"Start Value:"})),e.add(new UIBlur({value:t.sv,callback:function(e){t.sv=+e}})),e.add(new UILabel({text:"End Value:"})),e.add(new UIBlur({value:t.ev,callback:function(e){t.ev=+e}}))}}),this.left=new UIDragButton({text:"⬗",type:"left",callback:(e,n)=>{t.sf+=(e||-1)*(n||1),lns.ui.update()}}),this.right=new UIDragButton({text:"⬖",type:"right",callback:(e,t)=>{this.tween.ef+=(e||1)*(t||1),lns.ui.update()}}),this.remove=new UIButton({type:"remove",text:"🗑",callback:()=>{n.t.splice(n.t.indexOf(this),1),lns.ui.update()}}),this.append(this.edit),this.append(this.remove),this.append(this.left),this.append(this.right)}get html(){return this.el}}function Interface(e){const t=this,n={UILabel:UILabel,UIElement:UIElement,UIRange:UIRange,UIText:UIText,UIBlur:UIBlur,UITextRange:UITextRange,UIToggle:UIToggle,UIButton:UIButton,UIColor:UIColor,UISelect:UISelect,UISelectButton:UISelectButton,UICollection:UICollection,UIList:UIList,UIRow:UIRow};document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop"),this.keys={},this.faces={},this.panels=new UICollection({id:"panels"}),this.keyDown=function(e){let n=Cool.keys[e.which];"space"==n&&e.preventDefault(),n=e.shiftKey?"shift-"+n:n,n=e.ctrlKey?"ctrl-"+n:n,n=e.altKey?"alt-"+n:n;const s=t.keys[n];n&&s&&"text"!=document.activeElement.type&&!e.metaKey&&(e.preventDefault(),s.handler(e,s),s.onPress(!0))},document.addEventListener("keydown",t.keyDown,!1),window.toolTip=new UILabel({id:"tool-tip"}),document.getElementById("interface").appendChild(window.toolTip.el),this.load=function(e,n){fetch(e).then(e=>e.json()).then(e=>{for(const n in e)t.createPanel(n,e[n]);this.addSelect(Object.keys(e)),n&&n()})},this.addSelect=function(e){new UICollection({id:"selector"}).append(new UISelectButton({options:e,callback:function(e){t.panels[e].dock()},btn:"+"}))},this.createPanel=function(n,s){const a=new UIPanel(n,s.label);this.panels.append(a,n);for(let n=0;n<s.uis.length;n++){const i=s.uis[n],l=i.sub?e[i.module][i.sub]:e[i.module];for(let e=0;e<i.list.length;e++)t.createUI(i.list[e],l,a);"ui"==i.module&&i.sub&&(e.ui[i.sub].panel=a)}},this.createUI=function(e,s,a){const i={...e.params};e.key&&(i.key=e.key);for(const t in e.fromModule)i[t]=s[e.fromModule[t]];e.number&&(i.callback=function(t){s[e.number]=+t}),e.toggle&&(i.callback=function(){s[e.toggle]=!s[e.toggle]}),e.row&&a.addRow(),i.label&&a.add(new UILabel({text:i.label}));let l=new n[e.type](i);e.k?a.append(l,e.k):a.add(l),i.prompt&&(l.prompt=i.prompt),i.key&&(t.keys[e.key]=l),e.face&&(t.faces[e.face]=l)}}function Settings(e,t,n){const s=this;this.name="settings-"+t,this.save=function(){const t=n?{...n()}:{};t.panels={};for(const n in e.ui.panels)"el"!=n&&(t.panels[n]={open:e.ui.panels[n].isOpen,docked:e.ui.panels[n].isDocked,order:e.ui.panels[n].order,block:e.ui.panels[n].isBlock,headless:e.ui.panels[n].isHeadless});localStorage[s.name]=JSON.stringify(t)},this.load=function(t){if(localStorage[s.name]){const n=JSON.parse(localStorage[s.name]);t&&t(n);for(const t in n.panels)"el"!=t&&(n.panels[t].docked&&e.ui.panels[t].dock(),n.panels[t].open||e.ui.panels[t].open.update(),n.panels[t].block&&e.ui.panels[t].block(),n.panels[t].headless&&e.ui.panels[t].headless(),e.ui.panels[t].order=n.panels[t].order)}},this.clear=function(){delete localStorage[s.name]},this.toggleSaveSettings=function(){e.files.saveSettingsOnUnload=!e.files.saveSettingsOnUnload}}function appSave(){return{canvasColor:lns.canvas.bgColor,lineWidth:lns.canvas.ctx.lineWidth,c:lns.draw.layer.c,width:lns.canvas.width,height:lns.canvas.height,fps:lns.anim.fps,lps:lns.render.lps,onionSkinIsVisible:lns.render.onionSkinIsVisible,onionSkinNum:lns.render.onionSkinNum,mouseInterval:lns.draw.mouseInterval,palettes:lns.ui.palette.palettes,rl:lns.ui.faces.rl.value,timelineView:lns.ui.faces.timelineView.value,canvasScale:lns.ui.faces.canvasScale.value,interfaceScale:lns.ui.faces.interfaceScale.value}}function appLoad(e){lns.ui.faces.lps.update(e.lps),lns.ui.faces.onionSkinNum.update(e.onionSkinNum),lns.ui.faces.mouseInterval.update(e.mouseInterval),lns.ui.faces.width.update(e.width),lns.ui.faces.height.update(e.height),lns.ui.faces.bgColor.update(e.canvasColor),lns.ui.faces.timelineView.update(e.timelineView),lns.ui.faces.canvasScale.update(e.canvasScale),lns.ui.faces.interfaceScale.update(e.interfaceScale),lns.ui.faces.lineWidth.update(e.lineWidth),lns.ui.faces.fps.update(e.fps),lns.ui.faces.c.update(e.c),lns.ui.palette.setup(e.palettes),lns.ui.faces.rl.update(e.rl)}window.addEventListener("load",(function(){window.lns={},lns.canvas=new Canvas("lines",512,512,"#ffffff",!0),lns.render=new Render(10),lns.anim=new LnsAnim(lns.canvas.ctx),lns.draw=new Draw({n:2,r:1,w:1,v:.1,c:"#000000"}),lns.bgImage=new Background,lns.data=new Data(lns.anim),lns.files=new Files({fit:!1,save:!1,load:!0,reload:!1,bg:!0}),lns.ui=new Interface(lns),lns.ui.capture=new Capture,lns.ui.states=new States,lns.ui.palette=new Palette,lns.ui.drawings=new Drawings,lns.ui.play=new Play,lns.ui.timeline=new Timeline,setupAnimateInterface(lns.ui),lns.ui.settings=new Settings(lns,"lns",appSave),lns.ui.load("./interface/interface.json",(function(){lns.draw.setDefaults(),lns.ui.settings.load(appLoad);const e=location.search.split("=")[1];e&&lns.files.loadFile(e.split(".")[0],lns.ui.updateFIO),lns.ui.update(),lns.render.start(),lns.ui.timeline.init()}))}));
//# sourceMappingURL=src_maps/animate.min.js.map
